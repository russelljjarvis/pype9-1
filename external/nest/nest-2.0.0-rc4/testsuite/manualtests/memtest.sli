% Check for memory leak

/N 1000 def
/laps 1000 def

/BuildNetwork
{
  /iaf_neuron N Create pop
  1 1 N
  {
    /pre Set
    1 1 N
    {
      /post Set
      pre post Connect
    } for
  } for
} def

/TestMemory
{
  (Initializing ...\n) =
  BuildNetwork
  (Please look at the memory of the NEST process in top.) =
  (The values should stay between some upper and lower value,)=
  (but must not grow indefinitely.)=
  (Press ctrl-c to quit the test.) =

  1 1 laps
  { 
    (Lap number :) =only =
    {
      ResetKernel BuildNetwork
    } stopped
    {
       errordict begin /newerror false def end
       clear
       ResetKernel
       (Done .) =
       exit
    } if
 } for
} def

(type TestMemory to see if nest has a memory leak.) =
