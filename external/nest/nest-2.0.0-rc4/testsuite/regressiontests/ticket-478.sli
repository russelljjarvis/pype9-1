/*
 *  ticket-478.sli
 *
 *  This file is part of NEST
 *
 *  Copyright (C) 2010 by
 *  The NEST Initiative
 *
 *  See the file AUTHORS for details.
 *
 *  Permission is granted to compile and modify
 *  this file for non-commercial use.
 *  See the file LICENSE for details.
 *
 */

/* BeginDocumentation

Name: testsuite::ticket-478 Ensure that devices can only be connected using static synapses.

Synopsis: (ticket-478) run -> NEST exits if test fails

Description:
Ensure that NEST throws and exception if one tries to connect poisson_generator
(sending DSSpikeEvents), noise_generator (sending DSCurrentEvents) or multimeter
(sending DataLoggingRequest) to a neuron.

spike_generator slips through this test, since it usually sends SpikeEvent. But it
is no danger if it sends DSSpikeEvents for weighted spikes, since it sends precisely
one DSSpikeEvent per spike. 

Author: Hans Ekkehard Plesser, 2010-10-22
 */

/unittest (8831) require
/unittest using

M_ERROR setverbosity

% these should pass, but keep only those that are in synapsedict (if developer not present)
/statics 
[ /static_synapse /static_synapse_hom_wd /static_synapse_S ] 
{ synapsedict exch known }
Select
def

% now all the others
/plastics
synapsedict keys
{ statics exch MemberQ not }
Select 
def

ResetKernel
/n /iaf_neuron Create def
/dev [/multimeter Create /poisson_generator Create /noise_generator Create ] def

{
  statics
  { /st Set
    dev n st ConvergentConnect
  } forall
} pass_or_die

{
  plastics
  { /st Set
    dev n st ConvergentConnect
  } forall
} fail_or_die 
  
endusing