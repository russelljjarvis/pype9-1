
////////////////////
//Model Parameters//
////////////////////

/////////////////////////
//GoC>GoC Gap junctions//
////////////////////////

Ggap=1.5e-3  
CONNECTION_PROB_GoCGoC=1
k1_GoCGoC =0.03

//////////////////////
//Network Layers    //
//////////////////////

//load cells:
load_file("granule_template.hoc") //GrC
load_file("MF_template.hoc") //MF
load_file("Golgi_template.hoc") //GoC

//////////////////////////
//MF (Mossy Fibre) Layer//
//////////////////////////

objref mossy_fiber
mossy_fiber = new fibre(0.0, 0.0, 0.0)
mossy_fiber.Presynapse mossy_fiber.nclist.append(new NetCon(mossy_fiber.StimTrigger,mossy_fiber.syn,0.5,0,0.01)) 

/////////////////////////////////////
//GrC (granule Cell) Layer         //
/////////////////////////////////////

objref granule
granule = new grc(0.0,0.0,0.0) //create objects for cells

//////////////////////////
//GoC (golgi Cell) Layer//
//////////////////////////

objref golgi //define objects for cells
golgi = new Goc(0.0,0.0,0.0) //create objects for cells
golgi.soma.el_Golgi_lkg=-55 
golgi.dend[0].el_Golgi_lkg=-55 
golgi.dend[1].el_Golgi_lkg=-55 
golgi.dend[2].el_Golgi_lkg=-55 
golgi.soma.ko(0.5)=5
golgi.soma.ki(0.5)=140
golgi.soma.nao(0.5)=145
golgi.soma.nai(0.5)=5

////////////////////
//MF->GrC synapses//
////////////////////

mossy_fiber.Presynapse granule.nclist.append(new NetCon(&mossy_fiber.Presynapse.v(0.5), granule.synAMPA, -20, 1e-3, 1.3e-3))
mossy_fiber.Presynapse granule.nclist.append(new NetCon(&mossy_fiber.Presynapse.v(0.5), granule.synNMDA, -20, 1e-3, 0.1122e-3))  

////////////////////
//MF->GoC synapses//
////////////////////

mossy_fiber.Presynapse golgi.nclist.append(new NetCon(&mossy_fiber.Presynapse.v(0.5), golgi.synAMPA1, -20, 1e-3, 1.3e-3))

/////////////////////
//GrC->GoC synapses//
//(PF synapses)    //
/////////////////////

granule.soma golgi.nclist.append(new NetCon(&granule.soma.v(0.5), golgi.synAMPA2, -20, 1e-3, 1.3e-3))

////////////////////
//GoC>GrC synapses//
////////////////////

golgi.soma granule.nclist.append(new NetCon(&golgi.soma.v(0.5),granule.synGABAa1, -20, 1e-3, 1.4e-3))
//golgi[i].soma granule[j].nclist.append(new NetCon(&golgi[i].soma.v(0.5),granule[j].synGABAa2, -20, 1e-3, 1.4e-3))

/////////////////////////////
//MF stimulation procedures//
////////////////////////////

//clear stim buffers
proc cleanMF() {     
   mossy_fiber.StimTrigger.start=0
   mossy_fiber.StimTrigger.interval=0
   mossy_fiber.StimTrigger.number=0
   mossy_fiber.StimTrigger.noise=0
}

proc stimulus() {

  NETIN_SP_START=$1 
  MFfreq=$2
  NETIN_SP_NUMBER=50*$3 
  SEED=$4
  NETIN_SP_INTERVAL=1000/MFfreq 
  NETIN_SP_NOISE=0
  
  mossy_fiber.StimTrigger.start=NETIN_SP_START
  mossy_fiber.StimTrigger.interval=NETIN_SP_INTERVAL
  mossy_fiber.StimTrigger.number=NETIN_SP_NUMBER
  mossy_fiber.StimTrigger.noise=NETIN_SP_NOISE
  mossy_fiber.StimTrigger.seed(SEED)

}

////////////////////////////////////////
//Setting up for Saving Spiking Events//
///////////////////////////////////////

//generate matrix and send the data to them
objref golgi_spike_matrix, granule_spike_matrix, mossy_fiber_spike_matrix 
golgi_spike_matrix=new Matrix() 
granule_spike_matrix=new Matrix() 
mossy_fiber_spike_matrix=new Matrix() 

objref sav_mossy_fiber_spike_matrix,sav_granule_spike_matrix,sav_golgi_spike_matrix
sav_mossy_fiber_spike_matrix=new File()
sav_granule_spike_matrix=new File()
sav_golgi_spike_matrix=new File()

//Open recording Files
sav_mossy_fiber_spike_matrix.wopen("SingleMolLoopMossyFibers.spikes_dat")
sav_granule_spike_matrix.wopen("SingleMolLoopGranules.spikes_dat")
sav_golgi_spike_matrix.wopen("SingleMolLoopGolgis.spikes_dat")

//Data for Raster Plots
//GoC
objref timevec1, idvec1, recncs1, tobj1, nil1
timevec1 = new Vector()
idvec1 = new Vector()
recncs1 = new List()
golgi.soma tobj1 = new NetCon(&v(0.5), nil1)
tobj1.record(timevec1, idvec1, i+1) 
recncs1.append(tobj1)

objref tobj1 

//GrC
objref timevec2, idvec2, recncs2, tobj2, nil2
timevec2 = new Vector()
idvec2 = new Vector()
recncs2 = new List()
granule.soma tobj2 = new NetCon(&v(0.5), nil2)
tobj2.record(timevec2, idvec2, i+1) 
recncs2.append(tobj2)
objref tobj2 
