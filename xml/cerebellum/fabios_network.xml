<?xml version="1.0" encoding="UTF-8"?>
<nineml>
    <!-- The base network from which to build the main network -->
    <network id="CerebellarGranularLayer">
        <extensions>
            <engine id="Brep" cmd="brep" resource="brep_filename_goes_here.xml" output="build/brep" />
        </extensions>
        <!-- Populations -->
        <population id="Granules" cell="Granule">
            <layout type="Extension" engine="Brep" id="Granules" />
        </population>
        <population id="MossyFibers" cell="HH_cond_exp">
            <layout type="Extension" engine="Brep" id="MossyFibers" />
            <cellParameters>
                <const name="gbar_Na" value="0.25 S/cm2" />
                <const name="g_leak" value="0.0001666 S/cm2" />
                <const name="e_rev_leak" value="-60 mV" />
                <const name="diameter" value="10.0 um" />
                <const name="length" value="1.0 um" />
                <const name="Ra" value="123 Ohm/cm" />
            </cellParameters>
        </population>
        <population id="MossyFiberInputs" cell="SpikeSourceArray">
            <layout type="Extension" engine="Brep" id="MossyFibers" />
        </population>
        <population id="Golgis" cell="Granule">
            <layout type="Extension" engine="Brep" id="Golgis" />
        </population>
        <!-- Projections -->
        <projection id="MossyFiberInputs_MossyFibers">
            <source id="MossyFiberInputs" />
            <destination id="MossyFibers" synapse="excitatory" segment="source_section" />
            <connection pattern="OneToOne" />
            <weight pattern="Constant" value="0.01"/>
            <delay pattern="Constant" value="0.05"/>            
        </projection>
        <projection id="MossyFibers_Granules_AMPA">
            <source id="MossyFibers" />
            <destination id="Granules" synapse="AMPA" segment="soma" />
            <connection pattern="DistanceBased" geometry="CircleMask" radius="19.44 um"
                number="39" />
            <weight pattern="DistanceBased" geometry="ExponentialWith2DDistance" origin="2.6 uS"
                rate="-0.01" />
            <delay pattern="DistanceBased" geometry="LinearWith2DDistance" rate="2 us/um" />
        </projection>
        <projection id="MossyFibers_Granules_NMDA">
            <source id="MossyFibers" />
            <destination id="Granules" synapse="NMDA" segment="soma" />
            <connection pattern="DistanceBased" geometry="CircleMask" radius="19.44 um"
                number="25" />
            <weight pattern="DistanceBased" geometry="ExponentialWith2DDistance" origin="0.2244 uS"
                rate="-0.01" />
            <delay pattern="DistanceBased" geometry="LinearWith2DDistance" rate="2 us/um" />
            <comment> The mossy fiber branches before the cerebellum and in the granular layer and
                gives off the rosettes/glomeruli (estimates say that one mossy fiber gives off about
                150 rosettes, which may cross folia. The rosettes are at a distance of about 100um
                of each other. Each rosette talks to about 20+ granule cells, and about one Go Axon.
                Distribution of Glomeruli: Preferably homogeneous. Euclidean distance between
                rosettes about 85um (can be used as the radius of a sphere). Each Glomerulus
                contacts about 21 gr cells. One Glomerulus is contacted by a Golgi cell axon. We do
                not have that yet.
            </comment>
        </projection>
        <projection id="MossyFibers_Golgis_AMPA">
            <source id="MossyFibers" />
            <destination id="Golgis" synapse="AMPA" segment="soma" />
            <connection pattern="DistanceBased" geometry="CircleMask" radius="291 um"
                number="21" />
            <weight pattern="DistanceBased" geometry="ExponentialWith2DDistance" origin="2.6 nS"
                rate="-0.01" />
            <delay pattern="DistanceBased" geometry="LinearWith2DDistance" rate="2 us/um" />
        </projection>
        <projection id="Granules_Golgis">
            <source id="Granules" />
            <destination id="Golgis" synapse="GABA" segment="soma" />
            <connection pattern="Extension" engine="Brep" id="Granule-Golgi" />
            <comment> Golgi cells read off the parallel fibers. Golgi cell dendrites are confined to
                zebrin stripes. Each Golgi is estimated to read from up to 4000 granule cells (cat).
                The dendritic tree size is 200 x 600 x 180Î¼m in cats. A simple way to get this
                connectivity is to have an ellipsoid with the dendritic tree size. With the number
                of synapses as above.
            </comment>
        </projection>
        <projection id="Golgis_Granules">
            <source id="Golgis" />
            <destination id="Granules" synapse="GABA" segment="soma" />
            <connection pattern="DistanceBased" geometry="EllipseMask" x_scale="200 um"
                y_scale="58.35 um" number="350" /> <!-- x_scale="600 um" -->
            <weight pattern="DistanceBased" geometry="ExponentialWith2DDistance" origin="1.4 nS"
                rate="-0.01" />
            <delay pattern="DistanceBased" geometry="LinearWith2DDistance" rate="2 us/um" />
            <comment> There are about 400 Golgi cells per granule cell in the mouse. The axon does
                not seem to be confined as the dendrite, but it is rather flat and oriented in the
                same direction. Every granule cell receives from about 10 Golgi cells. I am not sure
                about this number. Better way to estimate it is to measure the axonal length and
                multiply by the density of synapses per um of axon. Currently we position the Golgi
                cells with a uniform distribution. We calculate the number of Golgi cells by 1.
                estimating the number of granule cells via density 2. multiplying that number by 400
            </comment>
        </projection>
        <projection id="Golgis_Golgis_Gap">
            <source id="Golgis" />
            <destination id="Golgis" synapse="Gap" segment="soma" />
            <connection pattern="DistanceBased" geometry="CircleMask" radius="10000000 um" />
            <!-- radius is set very large because in the model each golgi is connected to each other 
                golgi, but I can't use AllToAll and distance-based weight geometry at this point -->
            <weight pattern="DistanceBased" geometry="ExponentialWith2DDistance" origin="1.5 nS"
                rate="-0.03" />
            <comment> These are the golgi gap junction projection connections.
            </comment>
        </projection>
    </network>
</nineml>